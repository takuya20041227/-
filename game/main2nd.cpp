//--------------------------------------------------------------------------------------------------------------------------------------------------
//
//				SOZ_ver.4 
//		セカンドプロセスプログラム
//				Programed by Harada Academy Hi-Tech Group 
//
//--------------------------------------------------------------------------------------------------------------------------------------------------


//--------------------------------------------------------------------------------------------------------------------------------------------------
//インクルードファイル
//--------------------------------------------------------------------------------------------------------------------------------------------------

#ifdef WINDOWS_PC
#include    "../../../libs/systemOZ_v4/soz.h"
#else
#include    "D:/project/guardians_2dx/proj.win32/src/systemOZ/soz.h"
#endif

#include    "C:/project/town_break/src/game/game_include.h"






//--------------------------------------------------------------------------------------------------------------------------------------------------
//プロトタイプ宣言
//--------------------------------------------------------------------------------------------------------------------------------------------------
extern	SINT32	bg_color_r, bg_color_b, bg_color_g, bg_color_a;	//BG_COLORの変更に使う



//--------------------------------------------------------------------------------------------------------------------------------------------------
//定数の設定
//--------------------------------------------------------------------------------------------------------------------------------------------------



//--------------------------------------------------------------------------------------------------------------------------------------------------
// 変数宣言
//--------------------------------------------------------------------------------------------------------------------------------------------------
SINT32	exec_and_disp_process = 0;		//exec_and_disp_process  0にすると描画とタスクの実行をメインプロセスで行う。 1にすると、別プロセスからの描画が有効になる。その際、メインプロセスでは描画を行わない。










//--------------------------------------------------------------------------------------------------------------------------------------------------
// セカンドプロセス用メインルーチン
//--------------------------------------------------------------------------------------------------------------------------------------------------
void WINMAIN_second_process( void )
{
	HRESULT hr;
	static int  x;

	if( exec_and_disp_process == 1 )
	{
		hr = lpDEVICE->Clear(0, NULL, (D3DCLEAR_TARGET|D3DCLEAR_ZBUFFER), D3DCOLOR_RGBA( bg_color_r, bg_color_g, bg_color_g, bg_color_a), 1.0f, 0);
		TASK_exec();							//タスクの実行
		TASK_grp_sort();
		TASK_grp_set_quick();
		SOZ_Render_SOZBackBuffer_to_VRAM();
		hr = lpDEVICE->Present( NULL, NULL, NULL, NULL);		//画面のフリップ
	}
}



//--------------------------------------------------------------------------------------------------------------------------------------------------
// セカンドプロセス用メインルーチン
//--------------------------------------------------------------------------------------------------------------------------------------------------
void WINMAIN_process_set( SINT32 process_no )
{
	exec_and_disp_process = process_no;

	if( exec_and_disp_process == 1 )
	{
		SetTimer( hWnd, SOZ_2ND_PROCESS_ID, 1, NULL );		//1ミリ秒後読み込みが開始する。
	}
	else
	{
		KillTimer( hWnd, SOZ_2ND_PROCESS_ID );		//タイマー割り込みを終了させる。
	}
}

